<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible">
  <title></title>
  <meta charset="utf-8">
</head>
<body>

    <button onclick="startOauth();">Google</button>
    <br/>
    <button onclick="callApi();">Call Api</button>

    <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
    
     <script type="text/javascript">

        var clientId = '284651448201-0l5camnj82uu7keso8gvfn288fnsvga9.apps.googleusercontent.com';
        var authorizationUrlBase = 'https://accounts.google.com/o/oauth2/auth';
        var redirectUri = 'https://static-site-serve.herokuapp.com/oauth2callback.html';
        var scope = 'https://www.google.com/m8/feeds/';
        var state;

        function startOauth() {
            //generate a pseudo-random number for state
            var rand = Math.random();
            var dateTime = new Date().getTime();
            state = rand * dateTime;
            var url = authorizationUrlBase;
            url += '?response_type=token'
                +  '&redirect_uri=' + encodeURIComponent(redirectUri)
                +  '&client_id=' + encodeURIComponent(clientId)
                +  '&scope=' + encodeURIComponent(scope)
                +  '&state=' + encodeURIComponent(state);
            try {
                var w = window.open(url, '_blank', 'width=500,height=400');
            } catch (e) {
                console.log('error >>>>>>>>>>>>>', e)
            }
             
        }

        function setOauthParams(oauthParamsPassed) {
            if(parseFloat(oauthParamsPassed['state']) === this.state) {
                this.oauthParams = oauthParamsPassed;                
            } else {
                console.log(this.state, oauthParamsPassed['state'])
                throw 'setOauthParams parent error. State does not match'
            }
        }

        function callApi() {            
            var contactsUrl = 'https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json';            
            contactsUrl += "&access_token=" + encodeURIComponent(oauthParams['access_token']);            
            $.ajax({
                'url': contactsUrl,
                'dataType': 'jsonp',
                'success': function(data) {                    
                    showResponse(data);
                    
                },
                'error': function(error) {                    
                    showError(error);
                    
                }
            });
        }

        function showResponse(data) {            
            console.log('showResponse', data);
            console.log('showResponse>>>>', data.feed.entry.forEach( i => console.log(i.title.$t)) );
        }

        function showError(error) {            
            console.error(error)
        }

        

     </script>
</body>
</html>